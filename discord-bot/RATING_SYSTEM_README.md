# PeiPlay 評價系統說明

## 功能概述

評價系統會在預約結束後自動啟動，讓顧客對夥伴進行匿名評價，並將結果回報給管理員。

## 工作流程

### 1. 預約結束觸發
- 當語音頻道時間結束時，系統會自動刪除語音頻道
- 在文字頻道中顯示評價提示訊息

### 2. 評價界面
- 顯示美觀的嵌入訊息，說明評價流程
- 提供「⭐ 匿名評分」按鈕
- 評價按鈕有效時間：10分鐘

### 3. 評價表單
- 評分：1-5 星（必填）
- 留言：選填項目
- 完全匿名評價

### 4. 結果回報
- 評價提交後立即發送到管理員頻道
- 使用嵌入訊息格式，包含：
  - 評價者和被評價者資訊
  - 評分（星級顯示）
  - 留言內容
  - 配對記錄ID
  - 時間戳記

## 管理員頻道設定

預設管理員頻道ID：`1419601068110778450`

如需修改，請在 `.env` 文件中設定：
```
ADMIN_CHANNEL_ID=你的頻道ID
```

## 測試方法

運行測試腳本：
```bash
python test_rating_system.py
```

## 資料庫記錄

評價結果會保存在 `PairingRecord` 表中：
- `rating`: 評分（1-5）
- `comment`: 留言內容
- `user1_id`: 評價者ID
- `user2_id`: 被評價者ID

## 注意事項

1. 評價系統完全匿名，管理員無法看到具體是誰評價的
2. 每個配對記錄只能評價一次
3. 評價按鈕在10分鐘後自動失效
4. 文字頻道會在評價時間結束後自動刪除
5. 所有評價都會即時回報給管理員頻道

## 故障排除

如果評價系統不工作，請檢查：
1. 管理員頻道ID是否正確
2. Bot是否有發送訊息的權限
3. 資料庫連接是否正常
4. 配對記錄是否正確創建
