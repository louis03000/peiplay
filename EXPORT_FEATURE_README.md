# 📊 PeiPlay 消費紀錄匯出功能

## 🎯 功能概述

新的消費紀錄匯出功能會自動按照夥伴分組，並提供完整的消費統計和詳細記錄。

## 📋 匯出內容

### 1. **消費紀錄總覽** 工作表
- 夥伴姓名、Email、電話、Discord ID
- 每半小時收費標準
- 總接單數、總時長、總收入
- 平均每單收入

### 2. **詳細消費紀錄** 工作表（按夥伴分組）
每個夥伴的資料會自動分組，包含：
- **夥伴標題行**：藍色粗體，顯示該夥伴的總接單數和總收入
- **詳細訂單記錄**：包含所有訂單的完整資訊
- **統計行**：綠色粗體，顯示該夥伴的小計資訊
- **空行分隔**：不同夥伴之間自動分隔

#### 詳細欄位：
- 夥伴姓名
- 預約ID
- 訂單編號
- 預約日期、開始時間、結束時間
- 總時長(分鐘)
- 每半小時收費
- 收費金額
- 預約狀態
- 顧客姓名、Email、電話
- 建立時間
- 備註（拒絕原因等）

### 3. **時間統計** 工作表
按月份和夥伴分組的統計：
- 月份
- 夥伴姓名
- 接單數
- 總時長(小時)
- 總收入
- 平均每小時收入

## 🎨 樣式特色

- **標題行**：深藍色背景，白色粗體字
- **夥伴標題**：藍色粗體字，淺灰色背景
- **統計行**：綠色粗體字，淺綠色背景
- **自動分組**：每個夥伴的資料自動聚集在一起
- **清晰分隔**：不同夥伴之間有明顯的視覺分隔

## 🚀 使用方法

### 方法 1：管理員頁面
1. 登入管理員帳號
2. 前往「夥伴申請審核」頁面
3. 點擊「匯出消費紀錄 Excel」按鈕
4. 系統會自動下載 Excel 檔案

### 方法 2：直接 API 調用
```bash
GET /api/orders/export
```

## 📁 檔案命名

匯出的檔案會自動命名為：
```
peiplay_consumption_records_YYYY-MM-DD.xlsx
```

## 🔧 技術實現

- 使用 **ExcelJS** 庫生成 Excel 檔案
- 自動按夥伴分組和排序
- 包含完整的關聯資料查詢
- 支援中文顯示和格式化
- 自動計算統計數據

## 📊 資料來源

匯出功能會從以下資料表獲取資料：
- `Order` - 訂單資料
- `Booking` - 預約資料
- `Schedule` - 時段資料
- `Partner` - 夥伴資料
- `Customer` - 顧客資料
- `User` - 用戶資料

## ✅ 優勢特點

1. **自動分組**：無需手動整理，系統自動按夥伴分組
2. **完整資訊**：包含所有相關的詳細資料
3. **統計功能**：自動計算各種統計數據
4. **美觀排版**：使用顏色和樣式讓資料更易讀
5. **多工作表**：總覽、詳細記錄、時間統計分開顯示
6. **中文支援**：完全支援中文顯示和格式化

## 🎉 使用場景

- **財務報表**：計算夥伴收入分配
- **業績分析**：分析夥伴接單情況
- **時間統計**：了解各時段的營運狀況
- **顧客分析**：追蹤顧客消費模式
- **營運報告**：生成完整的營運統計報告
